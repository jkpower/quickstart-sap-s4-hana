{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Deploy SAP S/4HANA ABAP Cluster (ASCS, PAS & DB HA instances) + AAS (qs-1pfasf6sr)",
    "Metadata": {
        "AWS::CloudFormation::Interface": {
            "ParameterGroups": [{
                    "Label": {
                        "default": "Network infrastructure details"
                    },
                    "Description": {
                        "default": ""
                    },
                    "Parameters": [
                        "AvailabilityZones",
                        "VPCCIDR",
                        "PrivateSubnet1CIDR",
                        "PrivateSubnet2CIDR",
                        "PublicSubnet1CIDR",
                        "PublicSubnet2CIDR",
                        "RemoteAccessCIDR"
                    ]
                },
                {
                    "Label": {
                        "default": "HANA DB Server and storage configuration"
                    },
                    "Description": {
                        "default": ""
                    },
                    "Parameters": [
                        "MyOSHANA",
                        "SLESBYOSRegCode",
                        "SAPHANAHostname",
                        "HANAHostnameSecondary",
                        "HANAInstanceType",
                        "HANAHostCount",
                        "SID",
                        "HANAMasterPass",
                        "Encryption",
                        "VolumeTypeHanaData",
                        "VolumeTypeHanaLog",
                        "KeyName",
                        "HANAInstallMedia",
                        "EnableLogging",
                        "CloudTrailS3Bucket"
                    ]
                },
                {
                    "Label": {
                        "default": "SAP S/4HANA ABAP Cluster setup and configuration"
                    },
                    "Description": {
                        "default": ""
                    },
                    "Parameters": [
                        "HostedZoneName",
                        "StandardInstall",
                        "DistributedInstall",
                        "MyOS",
                        "EFSSapmnt",
                        "SAPASCSHostname",
                        "ASCSMyInstanceType",
                        "StbySAPASCS",
                        "SAPPASHostname",
                        "MyInstanceType",
                        "AutoRecoveryPAS",
                        "InstallSAP",
                        "InstallSAPVersion",
                        "SAPSchemaName",
                        "SAPSID",
                        "SAPInstanceNum",
                        "SIDadmUID",
                        "SAPTZ",
                        "SAPInstallMediaBucket",
                        "SAPInstallMediaKeyPrefix"
                    ]
                },
                {
                    "Label": {
                        "default": "SAP S/4HANA Additional App Server setup and configuration"
                    },
                    "Description": {
                        "default": ""
                    },
                    "Parameters": [
                        "InstallSAPAAS",
                        "SAPAASHostname",
                        "AASMyInstanceType",
                        "AutoRecoveryAAS"
                    ]
                },
                {
                    "Label": {
                        "default": "Optional configuration"
                    },
                    "Description": {
                        "default": ""
                    },
                    "Parameters": [
                        "InstallRDPAndBastionInstance",
                        "RDPInstanceType",
                        "BASTIONInstanceType"
                    ]
                },
                {
                    "Label": {
                        "default": "Advanced configuration (Do not modify unless directed by AWS Support)"
                    },
                    "Description": {
                        "default": ""
                    },
                    "Parameters": [
                        "QSS3BucketName",
                        "QSS3KeyPrefix"
                    ]
                }
            ],
            "ParameterLabels": {
                "AASMyInstanceType": {
                    "default": "SAP additional app server instance type"
                },
                "ASCSMyInstanceType": {
                    "default": "SAP ASCS instance type"
                },
                "AvailabilityZones": {
                    "default": "Availability Zones"
                },
                "AutoRecoveryAAS": {
                    "default": "AAS EC2 auto recovery"
                },
                "AutoRecoveryPAS": {
                    "default": "PAS EC2 auto recovery"
                },
                "BASTIONInstanceType": {
                    "default": "Bastion host"
                },
                "CloudTrailS3Bucket": {
                    "default": "S3 bucket for AWS CloudTrail & AWS Config logs"
                },
                "DistributedInstall": {
                    "default": "Split the ASCS and PAS (distributed installation)"
                },
                "StandardInstall": {
                    "default": "ASCS, PAS and DB in one host (standard installation)"
                },
                "EFSSapmnt": {
                    "default": "Use EFS for /sapmnt"
                },
                "EnableLogging": {
                    "default": "Enable AWS CloudTrail & AWS Config logs"
                },
                "Encryption": {
                    "default": "Enable encryption"
                },
                "HANAHostCount": {
                    "default": "SAP HANA DB host count"
                },
                "HANAInstallMedia": {
                    "default": "S3 bucket for HANA DB s/w."
                },
                "HANAInstanceType": {
                    "default": "SAP HANA server "
                },
                "HANAMasterPass": {
                    "default": "SAP HANA DB & S/4HANA ABAP password"
                },
                "HostedZoneName": {
                    "default": "R53 private hosted zone"
                },
                "InstallRDPAndBastionInstance": {
                    "default": "Install RDP and bastion"
                },
                "InstallSAP": {
                    "default": "Install SAP software"
                },
                "InstallSAPVersion": {
                    "default": "S/4HANA version"
                },
                "InstallSAPAAS": {
                    "default": "Install SAP additional app server"
                },
                "KeyName": {
                    "default": "SSH key pair"
                },
                "MyInstanceType": {
                    "default": "SAP PAS server instance type"
                },
                "MyOS": {
                    "default": "O.S. version for S/4HANA servers"
                },
                "MyOSHANA": {
                    "default": "Operating system version for HANA (RHEL or SLES)"
                },
                "PrivateSubnet1CIDR": {
                    "default": "Private subnet 1 CIDR"
                },
                "PrivateSubnet2CIDR": {
                    "default": "Private subnet 2 CIDR"
                },
                "PublicSubnet1CIDR": {
                    "default": "Public subnet 1 CIDR"
                },
                "PublicSubnet2CIDR": {
                    "default": "Public subnet 2 CIDR"
                },
                "QSS3BucketName": {
                    "default": "S3 bucket name for the Quick Start assets."
                },
                "QSS3KeyPrefix": {
                    "default": "S3 key prefix for the Quick Start assets"
                },
                "RDPInstanceType": {
                    "default": "RDP instance"
                },
                "RemoteAccessCIDR": {
                    "default": "CIDR block for RDP & bastion access"
                },
                "SAPAASHostname": {
                    "default": "SAP AAS server host name (i.e. sidapp00)"
                },
                "SAPASCSHostname": {
                    "default": "SAP ASCS server virtual name (i.e. sidasc00)"
                },
                "StbySAPASCS": {
                    "default": "Standby ASCS server in a different Availability Zone"
                },
                "SAPHANAHostname": {
                    "default": "SAP HANA server host name (i.e. siddbmas)"
                },
                "HANAHostnameSecondary": {
                    "default": "SAP HANA server host name for Secondary node (i.e. siddbsec)"
                },
                "SAPInstallMediaBucket": {
                    "default": "S3 bucket for SAP S/4HANA s/w."
                },
                "SAPInstallMediaKeyPrefix": {
                    "default": "S3 Key Prefix for SAP S/4HANA s/w."
                },
                "SAPInstanceNum": {
                    "default": "SAP instance number"
                },
                "SAPPASHostname": {
                    "default": "SAP PAS server host name (i.e. sidpas00)"
                },
                "SAPTZ": {
                    "default": "SAP server timezone"
                },
                "SAPSchemaName": {
                    "default": "SAP database schema"
                },
                "SID": {
                    "default": "HANA DB system ID"
                },
                "SAPSID": {
                    "default": "S/4HANA ABAP system ID"
                },
                "SIDadmUID": {
                    "default": "SIDadm user id"
                },
                "SLESBYOSRegCode": {
                    "default": "Enter SUSE BYOS registration code"
                },
                "VPCCIDR": {
                    "default": "VPC CIDR"
                },
                "VolumeTypeHanaData": {
                    "default": "Choose storage volume type for SAP HANA data"
                },
                "VolumeTypeHanaLog": {
                    "default": "Choose storage volume type for SAP HANA log"
                },
                "VolumeType": {
                    "default": "EBS storage volume type"
                }
            }
        }
    },
    "Parameters": {
        "AutoRecoveryAAS": {
            "Type": "String",
            "Description": "EC2 Automatic recovery feature",
            "Default": "Yes",
            "AllowedValues": [
                "Yes",
                "No"
            ]
        },
        "AutoRecoveryPAS": {
            "Type": "String",
            "Description": "EC2 Automatic recovery feature",
            "Default": "Yes",
            "AllowedValues": [
                "Yes",
                "No"
            ]
        },
        "AASMyInstanceType": {
            "AllowedValues": [
                "r4.4xlarge",
                "r4.2xlarge",
                "r4.xlarge",
                "r4.large",
                "r5.4xlarge",
                "r5.2xlarge",
                "r5.xlarge",
                "r5.large",
                "m4.4xlarge",
                "m4.2xlarge",
                "m4.xlarge",
                "m4.large",
                "m5.4xlarge",
                "m5.2xlarge",
                "m5.xlarge",
                "m5.large",
                "c4.4xlarge",
                "c4.2xlarge",
                "c4.xlarge",
                "c4.large",
                "c5.4xlarge",
                "c5.2xlarge",
                "c5.xlarge",
                "c5.large"
            ],
            "Default": "r5.xlarge",
            "Description": "Instance type for SAP Additional App Servers.",
            "Type": "String"
        },
        "ASCSMyInstanceType": {
            "AllowedValues": [
                "r4.4xlarge",
                "r4.2xlarge",
                "r4.xlarge",
                "r4.large",
                "r5.4xlarge",
                "r5.2xlarge",
                "r5.xlarge",
                "r5.large",
                "m4.4xlarge",
                "m4.2xlarge",
                "m4.xlarge",
                "m4.large",
                "m5.4xlarge",
                "m5.2xlarge",
                "m5.xlarge",
                "m5.large",
                "c4.4xlarge",
                "c4.2xlarge",
                "c4.xlarge",
                "c4.large",
                "c5.4xlarge",
                "c5.2xlarge",
                "c5.xlarge",
                "c5.large"
            ],
            "Default": "r5.large",
            "Description": "Instance type for SAP ASCS Server.",
            "Type": "String"
        },
        "AvailabilityZones": {
            "Description": "Availability Zones to use for the subnets in the VPC. Two Availability Zones are used for this deployment and the logical order of your selections is preserved.",
            "Type": "List<AWS::EC2::AvailabilityZone::Name>"
        },
        "BASTIONInstanceType": {
            "AllowedValues": [
                "t2.small",
                "t2.medium",
                "t2.large",
                "m4.large",
                "c4.large"
            ],
            "Default": "t2.small",
            "Description": "Amazon EC2 instance type for the bastion host.",
            "Type": "String"
        },
        "CloudTrailS3Bucket": {
            "Description": "Name of Amazon S3 bucket where AWS CloudTrail Trail and AWS Config logs can be stored (e.g. mycloudtrail).",
            "Default": "",
            "Type": "String"
        },
        "DistributedInstall": {
            "Description": "Split ASCS and PAS onto 2 different instances",
            "Default": "No",
            "Type": "String",
            "AllowedValues": [
                "Yes",
                "No"
            ]
        },
        "StandardInstall": {
            "Description": "ASCS, PAS and DB in one EC2 Instance (System ID <SID> for HANA DB and S/4HANA must be different).",
            "Default": "No",
            "Type": "String",
            "AllowedValues": [
                "Yes",
                "No"
            ]
        },
        "EnableLogging": {
            "Description": "Enable (Yes) or disable (No) logging with AWS CloudTrail and AWS Config",
            "Default": "No",
            "Type": "String",
            "AllowedValues": [
                "Yes",
                "No"
            ]
        },
        "Encryption": {
            "AllowedValues": [
                "Yes",
                "No"
            ],
            "Default": "No",
            "Description": "Enable (Yes) or disable (No) encryption on EBS volumes.",
            "Type": "String"
        },
        "EFSSapmnt": {
            "AllowedValues": [
                "Yes",
                "No"
            ],
            "Default": "No",
            "Description": "Enable (Yes) or disable (No) EFS for /sapmnt.",
            "Type": "String"
        },
        "HANAHostCount": {
            "Default": "1",
            "Description": "Total number of SAP HANA DB nodes you want to deploy in the SAP HANA DB cluster.",
            "MaxValue": "5",
            "MinValue": "1",
            "Type": "Number"
        },
        "HANAInstallMedia": {
            "Default": "s3://   /",
            "Description": "Name of your S3 bucket for your SAP HANA DB s/w. The s/w will *not* download if the format is not correct (e.g., s3://mysapbucket/HANA-media/).",
            "Type": "String"
        },
        "HANAInstanceType": {
            "AllowedValues": [
                "r3.8xlarge",
                "r3.4xlarge",
                "r3.2xlarge",
                "r4.16xlarge",
                "r4.8xlarge",
                "r4.4xlarge",
                "r4.2xlarge",
                "r5.2xlarge",
                "r5.4xlarge",
                "r5.12xlarge",
                "r5.24xlarge",
                "x1.16xlarge",
                "x1.32xlarge",
                "x1e.xlarge",
                "x1e.2xlarge",
                "x1e.4xlarge",
                "x1e.32xlarge",
                "u-6tb1.metal",
                "u-9tb1.metal",
                "u-12tb1.metal",
                "u-18tb1.metal",
                "u-24tb1.metal"
            ],
            "Default": "r5.4xlarge",
            "Description": "Instance type for SAP HANA DB Server.",
            "Type": "String"
        },
        "HANAMasterPass": {
            "AllowedPattern": "^(?=.*?[a-z])(?=.*?[A-Z])(?=.*[0-9]).*",
            "ConstraintDescription": "This must be at least 8 characters, including uppercase, lowercase, and numeric values.",
            "Description": "SAP HANA DB and S/4HANA password to use during installations.",
            "MinLength": "8",
            "NoEcho": "true",
            "Type": "String"
        },
        "HostedZoneName": {
            "Description": "A R53 privated hosted zone will be created. Use a fully-qualified domain name e.g. mycompany.local",
            "Type": "String",
            "MinLength": "1",
            "MaxLength": "64",
            "AllowedPattern": "(?!-)[a-zA-Z0-9-.]*(?<!-)",
            "ConstraintDescription": "must be a valid fully-qualified domain name."
        },
        "InstallRDPAndBastionInstance": {
            "AllowedValues": [
                "Yes",
                "No"
            ],
            "Default": "Yes",
            "Description": "Install (Yes) or don't install (No) optional RDP & Bastion instances.",
            "Type": "String"
        },
        "InstallSAP": {
            "AllowedValues": [
                "Yes",
                "No"
            ],
            "Default": "Yes",
            "Description": "Install (Yes) or don't install (No) S/4HANA App Server. When No, *only* the AWS infrastructure is provisioned.",
            "Type": "String"
        },
        "InstallSAPVersion": {
            "Type": "String",
            "Description": "SAP S/4HANA version to install.",
            "Default": "S/4HANA-1809",
            "AllowedValues": [
                "S/4HANA-1809"
            ]
        },
        "InstallSAPAAS": {
            "AllowedValues": [
                "Yes",
                "No"
            ],
            "Default": "No",
            "Description": "Install (Yes) or (No) don't install SAP Additional App Servers. When No, *only* the SAP ASCS, DB & PAS are installed.",
            "Type": "String"
        },
        "KeyName": {
            "Description": "Name of an existing Amazon EC2 key pair. All instances will launch with this key pair.",
            "Type": "AWS::EC2::KeyPair::KeyName"
        },
        "MyInstanceType": {
            "AllowedValues": [
                "r4.4xlarge",
                "r4.2xlarge",
                "r4.xlarge",
                "r4.large",
                "r5.4xlarge",
                "r5.2xlarge",
                "r5.xlarge",
                "r5.large",
                "m4.4xlarge",
                "m4.2xlarge",
                "m4.xlarge",
                "m4.large",
                "m5.4xlarge",
                "m5.2xlarge",
                "m5.xlarge",
                "m5.large",
                "c4.4xlarge",
                "c4.2xlarge",
                "c4.xlarge",
                "c4.large",
                "c5.4xlarge",
                "c5.2xlarge",
                "c5.xlarge",
                "c5.large"
            ],
            "Default": "r5.xlarge",
            "Description": "Instance type for S/4HANA App Server.",
            "Type": "String"
        },
        "MyOS": {
            "AllowedValues": [
                "Red-Hat-Enterprise-Linux-7.5-For-SAP-HVM",
                "Red-Hat-Enterprise-Linux-7.4-For-SAP-HA-US-HVM",
                "Red-Hat-Enterprise-Linux-7.5-For-SAP-HA-US-HVM",
                "Red-Hat-Enterprise-Linux-7.6-For-SAP-HA-US-HVM",
                "SuSE-Linux-11-SP4-HVM",
                "SuSE-Linux-12-SP1-HVM",
                "SuSE-Linux-12-SP3-HVM",
                "SuSE-Linux-12-SP4-HVM",
                "SuSE-Linux-15-HVM",
                "SuSE-Linux-12-SP2-For-SAP-HVM",
                "SuSE-Linux-12-SP3-For-SAP-HVM",
                "SuSE-Linux-12-SP4-For-SAP-HVM",
                "SuSE-Linux-15-For-SAP-HVM",
                "SuSE-Linux-12-SP1-For-SAP-BYOS-HVM",
                "SuSE-Linux-12-SP2-For-SAP-BYOS-HVM",
                "SuSE-Linux-12-SP3-For-SAP-BYOS-HVM",
                "SuSE-Linux-12-SP4-For-SAP-BYOS-HVM",
                "SuSE-Linux-15-For-SAP-BYOS-HVM"
            ],
            "Default": "SuSE-Linux-12-SP4-For-SAP-HVM",
            "Description": "Operating system version for S/4HANA App servers.",
            "Type": "String"
        },
        "MyOSHANA": {
            "Type": "String",
            "Description": "Operating system version for HANA DB servers.",
            "Default": "SuSE-Linux-12-SP4-For-SAP-HVM",
            "AllowedValues": [
                "Red-Hat-Enterprise-Linux-7.4-For-SAP-HA-US-HVM",
                "Red-Hat-Enterprise-Linux-7.5-For-SAP-HA-US-HVM",
                "Red-Hat-Enterprise-Linux-7.6-For-SAP-HA-US-HVM",
                "SuSE-Linux-12-SP2-For-SAP-HVM",
                "SuSE-Linux-12-SP3-For-SAP-HVM",
                "SuSE-Linux-12-SP4-For-SAP-HVM",
                "SuSE-Linux-15-For-SAP-HVM",
                "SuSE-Linux-12-SP1-For-SAP-BYOS-HVM",
                "SuSE-Linux-12-SP2-For-SAP-BYOS-HVM",
                "SuSE-Linux-12-SP3-For-SAP-BYOS-HVM",
                "SuSE-Linux-12-SP4-For-SAP-BYOS-HVM",
                "SuSE-Linux-15-For-SAP-BYOS-HVM"
            ]
        },
        "PrivateSubnet1CIDR": {
            "AllowedPattern": "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$",
            "ConstraintDescription": "CIDR block parameter must be in the form x.x.x.x/16-28",
            "Default": "10.0.0.0/19",
            "Description": "CIDR block for private subnet 1 located in Availability Zone 1",
            "Type": "String"
        },
        "PrivateSubnet2CIDR": {
            "AllowedPattern": "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$",
            "ConstraintDescription": "CIDR block parameter must be in the form x.x.x.x/16-28",
            "Default": "10.0.32.0/19",
            "Description": "CIDR block for private subnet 2 located in Availability Zone 2",
            "Type": "String"
        },
        "PublicSubnet1CIDR": {
            "AllowedPattern": "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$",
            "ConstraintDescription": "CIDR block parameter must be in the form x.x.x.x/16-28",
            "Default": "10.0.128.0/20",
            "Description": "CIDR block for the public (DMZ) subnet 1 located in Availability Zone 1",
            "Type": "String"
        },
        "PublicSubnet2CIDR": {
            "AllowedPattern": "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$",
            "ConstraintDescription": "CIDR block parameter must be in the form x.x.x.x/16-28",
            "Default": "10.0.144.0/20",
            "Description": "CIDR block for the public (DMZ) subnet 2 located in Availability Zone 2",
            "Type": "String"
        },
        "QSS3BucketName": {
            "AllowedPattern": "^[0-9a-zA-Z]+([0-9a-zA-Z-]*[0-9a-zA-Z])*$",
            "ConstraintDescription": "Quick Start bucket name can include numbers, lowercase letters, uppercase letters, and hyphens (-). It cannot start or end with a hyphen (-).",
            "Default": "aws-quickstart",
            "Description": "S3 bucket name for the Quick Start assets. This string can include numbers, lowercase letters, uppercase letters, and hyphens (-). It cannot start or end with a hyphen (-).",
            "Type": "String"
        },
        "QSS3KeyPrefix": {
            "AllowedPattern": "^[0-9a-zA-Z-/]*$",
            "ConstraintDescription": "Quick Start key prefix can include numbers, lowercase letters, uppercase letters, hyphens (-), and forward slash (/).",
            "Default": "quickstart-sap-s4-hana/",
            "Description": "S3 key prefix for the Quick Start assets. Quick Start key prefix can include numbers, lowercase letters, uppercase letters, hyphens (-), and forward slash (/).",
            "Type": "String"
        },
        "RDPInstanceType": {
            "AllowedValues": [
                "c4.large",
                "c4.xlarge",
                "m4.large",
                "m4.xlarge"
            ],
            "Default": "m4.large",
            "Description": "Instance type for Windows RDP instance.",
            "Type": "String"
        },
        "RemoteAccessCIDR": {
            "AllowedPattern": "(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})",
            "ConstraintDescription": "This must be a valid CIDR range in the format x.x.x.x/x.",
            "Default": "0.0.0.0/0",
            "Description": "CIDR block from where you want to access instances in your public subnet(s).",
            "MaxLength": "18",
            "MinLength": "9",
            "Type": "String"
        },
        "SAPAASHostname": {
            "Default": "sidapp00",
            "Description": "Host name *template* to use for SAP AAS Server",
            "Type": "String"
        },
        "SAPASCSHostname": {
            "Default": "sidasc00",
            "Description": "Virtual Hostname for SAP ASCS Server",
            "Type": "String"
        },
        "StbySAPASCS": {
            "AllowedValues": [
                "Yes",
                "No"
            ],
            "Default": "No",
            "Description": "Enable (Yes) or disable (No) Standby ASCS instance.",
            "Type": "String"
        },
        "SAPHANAHostname": {
            "Default": "siddbmas",
            "Description": "Host name to use for SAP HANA DB server (SAP App server must be able to access HANA server).",
            "Type": "String"
        },
        "HANAHostnameSecondary": {
            "Default": "siddbsec",
            "Description": "Host name to use for SAP HANA Secondary DB server node.",
            "Type": "String"
        },
        "SAPInstallMediaBucket": {
            "Default": "my-sw-bucket",
            "Description": "Name of your S3 bucket for your SAP S/4HANA s/w. Do *NOT* include s3:// (use just your bucket name)",
            "Type": "String"
        },
        "SAPInstallMediaKeyPrefix": {
            "Default": "my/sw/version/",
            "Description": "Name of your S3 Key Prefix for your SAP S/4HANA s/w. Leave blank if you do not use a Key Prefix",
            "Type": "String"
        },
        "SAPInstanceNum": {
            "AllowedPattern": "([0-9]{1}[0-7]{1})",
            "Default": "00",
            "Description": "SAP instance number to use for installation and setup, and to open ports for security groups.",
            "Type": "String"
        },
        "SAPPASHostname": {
            "Default": "sidpas00",
            "Description": "Host name to use for SAP PAS Server (DNS short name).",
            "Type": "String"
        },
        "SAPTZ": {
            "AllowedValues": [
                "PT",
                "CT",
                "ET",
                "UC"
            ],
            "ConstraintDescription": "This value must consist of 2 characters.",
            "Default": "UC",
            "Description": "The TimeZone of your SAP Server (PT, CT, ET, or UTC)",
            "Type": "String"
        },
        "SID": {
            "AllowedPattern": "([A-Z]{1}[0-9A-Z]{2})",
            "ConstraintDescription": "This value must consist of 3 characters.",
            "Default": "HDB",
            "Description": "HANA Database system ID for installation and setup.",
            "Type": "String"
        },
        "SAPSID": {
            "AllowedPattern": "([A-Z]{1}[0-9A-Z]{2})",
            "ConstraintDescription": "This value must consist of 3 characters.",
            "Default": "S4H",
            "Description": "S/4HANA ABAP system ID for installation and setup (Must be different than the DB SID for Standard installation).",
            "Type": "String"
        },
        "SAPSchemaName": {
            "Default": "SAPHANADB",
            "Description": "SAP ABAP Schema name for HANA database.",
            "Type": "String"
        },
        "SIDadmUID": {
            "Default": "1002",
            "Description": "UID (default is 1002) for the SIDadm user.",
            "Type": "String"
        },
        "SLESBYOSRegCode": {
            "Type": "String",
            "Default": "",
            "Description": "Registration code for SUSE BYOS (Applicable only if you use BYOS Option)."
        },
        "VolumeTypeHanaData": {
            "Type": "String",
            "Description": "EBS volume type for SAP HANA Data: General Purpose SSD (gp2) or Provisioned IOPS SSD (io1).",
            "Default": "gp2",
            "AllowedValues": [
                "gp2",
                "io1"
            ]
        },
        "VolumeTypeHanaLog": {
            "Type": "String",
            "Description": "EBS volume type for SAP HANA Log: General Purpose SSD (gp2) or Provisioned IOPS SSD (io1).",
            "Default": "gp2",
            "AllowedValues": [
                "gp2",
                "io1"
            ]
        },
        "VPCCIDR": {
            "AllowedPattern": "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$",
            "ConstraintDescription": "CIDR block parameter must be in the form x.x.x.x/16-28",
            "Default": "10.0.0.0/16",
            "Description": "CIDR block for the VPC",
            "Type": "String"
        }
    },
    "Conditions": {
        "InstallRDPAndBastion": {
            "Fn::Equals": [{
                    "Ref": "InstallRDPAndBastionInstance"
                },
                "Yes"
            ]
        },
        "SplitASCS": {
            "Fn::Equals": [{
                    "Ref": "DistributedInstall"
                },
                "Yes"
            ]
        },
        "UseStandard": {
            "Fn::Equals": [
                {
                    "Ref": "StandardInstall"
                },
                "Yes"
            ]
        },
        "NoUseStandard": {
            "Fn::Equals": [
                {
                    "Ref": "StandardInstall"
                },
                "No"
            ]
        },
        "NoSplitASCS": {
            "Fn::Equals": [{
                    "Ref": "DistributedInstall"
                },
                "No"
            ]
        },
        "UseEFS": {
            "Fn::Equals": [{
                    "Ref": "EFSSapmnt"
                },
                "Yes"
            ]
        },
        "NoUseEFS": {
            "Fn::Equals": [{
                    "Ref": "EFSSapmnt"
                },
                "No"
            ]
        },
        "SplitandEFS": {
            "Fn::And": [{
                "Condition": "SplitASCS"
            }, {
                "Condition": "NoUseStandard" 
            }, {
                "Condition": "UseEFS"
            }]
        },
        "SplitandNoEFS": {
            "Fn::And": [{
                "Condition": "SplitASCS"
            }, {
                "Condition": "NoUseStandard" 
            }, {
                "Condition": "NoUseEFS"
            }]
        },
        "NoSplitandEFS": {
            "Fn::And": [{
                "Condition": "NoSplitASCS"
            }, {
                "Condition": "NoUseStandard" 
            }, {
                "Condition": "UseEFS"
            }]
        },
        "NoSplitandNoEFS": {
            "Fn::And": [{
                "Condition": "NoSplitASCS"
            }, {
                "Condition": "NoUseStandard" 
            }, {
                "Condition": "NoUseEFS"
            }]
        },
        "StandardBuild": {
            "Fn::And": [{
                "Condition": "NoSplitASCS"
            }, {
                "Condition": "NoUseEFS" 
            }, {
                "Condition": "UseStandard" 
            }]
        }
    },
    "Mappings": {},
    "Resources": {
        "VPCStack": {
            "Type": "AWS::CloudFormation::Stack",
            "Properties": {
                "TemplateURL": {
                    "Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}submodules/quickstart-aws-vpc/templates/aws-vpc.template"
                },
                "Parameters": {
                    "AvailabilityZones": {
                        "Fn::Join": [
                            ",",
                            {
                                "Ref": "AvailabilityZones"
                            }
                        ]
                    }, 
                    "KeyPairName": {
                        "Ref": "KeyName"
                    },
                    "NumberOfAZs": "2",
                    "PrivateSubnet1ACIDR": {
                        "Ref": "PrivateSubnet1CIDR"
                    },
                    "PrivateSubnet2ACIDR": {
                        "Ref": "PrivateSubnet2CIDR"
                    },
                    "PublicSubnet1CIDR": {
                        "Ref": "PublicSubnet1CIDR"
                    },
                    "PublicSubnet2CIDR": {
                        "Ref": "PublicSubnet2CIDR"
                    },
                    "VPCCIDR": {
                        "Ref": "VPCCIDR"
                    }
                }
            }
        },
        "SingleRTAssociation": {
            "DependsOn": "VPCStack",
            "Type" : "AWS::EC2::SubnetRouteTableAssociation",
            "Properties" : {
                "RouteTableId": {"Fn::GetAtt": ["VPCStack", "Outputs.PrivateSubnet1ARouteTable"]},
                "SubnetId": {"Fn::GetAtt": ["VPCStack", "Outputs.PrivateSubnet2AID"]}
            }
        },   
        "LinuxBastionStack": {
            "DependsOn": "VPCStack",
            "Type": "AWS::CloudFormation::Stack",
            "Condition": "InstallRDPAndBastion",
            "Properties": {
                "TemplateURL": {
                    "Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}submodules/quickstart-linux-bastion/templates/linux-bastion.template"
                },
                "Parameters": {
                    "BastionInstanceType": {
                        "Ref": "BASTIONInstanceType"
                    },
                    "KeyPairName": {
                        "Ref": "KeyName"
                    },
                    "PublicSubnet1ID": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PublicSubnet1ID"
                        ]
                    },
                    "PublicSubnet2ID": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PublicSubnet2ID"
                        ]
                    },
                    "QSS3BucketName": {
                        "Ref": "QSS3BucketName"
                    },
                    "QSS3KeyPrefix": {
                        "Fn::Sub": "${QSS3KeyPrefix}submodules/quickstart-linux-bastion/"
                    },
                    "RemoteAccessCIDR": {
                        "Ref": "RemoteAccessCIDR"
                    },
                    "VPCID": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.VPCID"
                        ]
                    }
                }
            }
        },
        "SAPASCSStackSplitandEFS": {
            "Type": "AWS::CloudFormation::Stack",
            "Condition": "SplitandEFS",
            "Properties": {
                "TemplateURL": {
                    "Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}templates/sap-s4hana-ascs-HA.template"
                },
                "Parameters": {
                    "EFSSapmnt": {
                        "Ref": "EFSSapmnt"
                    },
                    "HANAMasterPass": {
                        "Ref": "HANAMasterPass"
                    },
                    "HANAHostCount": {
                        "Ref": "HANAHostCount"
                    },
                    "SAPHANAHostname": {
                        "Ref": "SAPHANAHostname"
                    },
                    "HANAHostnameSecondary": {
                        "Ref": "HANAHostnameSecondary"
                    },
                    "HANAInstallMedia": {
                        "Ref": "HANAInstallMedia"
                    },
                    "HANAInstanceType": {
                        "Ref": "HANAInstanceType"
                    },
                    "HostedZoneName": {
                        "Ref": "HostedZoneName"
                    },
                    "InstallRDPInstance": {
                        "Ref": "InstallRDPAndBastionInstance"
                    },
                    "InstallSAP": {
                        "Ref": "InstallSAP"
                    },
                    "InstallSAPVersion": {
                        "Ref": "InstallSAPVersion"
                    },
                    "KeyName": {
                        "Ref": "KeyName"
                    },
                    "MyInstanceType": {
                        "Ref": "MyInstanceType"
                    },
                    "MyOS": {
                        "Ref": "MyOS"
                    },
                    "MyOSHANA": {
                        "Ref": "MyOSHANA"
                    },
                    "ApplicationCIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet2AID"
                        ]
                    },
                    "PrivateSubnetID": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet1AID"
                        ]
                    },
                    "PrivateSubnet1AID": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet1AID"
                        ]
                    },
                    "PublicSubnet1ID": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PublicSubnet1ID"
                        ]
                    },
                    "PrivateSubnet1CIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet1ACIDR"
                        ]
                    },
                    "PrivateSubnet2CIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet2ACIDR"
                        ]
                    },
                    "PublicSubnet1CIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PublicSubnet1CIDR"
                        ]
                    },
                    "PublicSubnet2CIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PublicSubnet2CIDR"
                        ]
                    },
                    "QSS3BucketName": {
                        "Ref": "QSS3BucketName"
                    },
                    "QSS3KeyPrefix": {
                        "Ref": "QSS3KeyPrefix"
                    },
                    "RDPInstanceType": {
                        "Ref": "RDPInstanceType"
                    },
                    "SAPASCSHostname": {
                        "Ref": "SAPASCSHostname"
                    },
                    "StbySAPASCS": {
                        "Ref": "StbySAPASCS"
                    },
                    "SAPInstallMediaBucket": {
                        "Ref": "SAPInstallMediaBucket"
                    },
                    "SAPInstallMediaKeyPrefix": {
                        "Ref": "SAPInstallMediaKeyPrefix"
                    },
                    "SAPInstanceNum": {
                        "Ref": "SAPInstanceNum"
                    },
                    "SAPNetWeaverPass": {
                        "Ref": "HANAMasterPass"
                    },
                    "SAPTZ": {
                        "Ref": "SAPTZ"
                    },
                    "SID": {
                        "Ref": "SID"
                    },
                    "SIDadmUID": {
                        "Ref": "SIDadmUID"
                    },
                    "SLESBYOSRegCode": {
                        "Ref": "SLESBYOSRegCode"
                    },
                    "VPCID": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.VPCID"
                        ]
                    }
                }
            }
        },
        "SAPASCSStackSplitNoEFS": {
            "Type": "AWS::CloudFormation::Stack",
            "Condition": "SplitandNoEFS",
            "Properties": {
                "TemplateURL": {
                    "Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}templates/sap-s4hana-ascs-HA.template"
                },
                "Parameters": {
                    "EFSSapmnt": {
                        "Ref": "EFSSapmnt"
                    },
                    "HANAMasterPass": {
                        "Ref": "HANAMasterPass"
                    },
                    "HANAHostCount": {
                        "Ref": "HANAHostCount"
                    },
                    "SAPHANAHostname": {
                        "Ref": "SAPHANAHostname"
                    },
                    "HANAHostnameSecondary": {
                        "Ref": "HANAHostnameSecondary"
                    },
                    "HANAInstallMedia": {
                        "Ref": "HANAInstallMedia"
                    },
                    "HANAInstanceType": {
                        "Ref": "HANAInstanceType"
                    },
                    "HostedZoneName": {
                        "Ref": "HostedZoneName"
                    },
                    "InstallRDPInstance": {
                        "Ref": "InstallRDPAndBastionInstance"
                    },
                    "InstallSAP": {
                        "Ref": "InstallSAP"
                    },
                    "InstallSAPVersion": {
                        "Ref": "InstallSAPVersion"
                    },
                    "KeyName": {
                        "Ref": "KeyName"
                    },
                    "MyInstanceType": {
                        "Ref": "MyInstanceType"
                    },
                    "MyOS": {
                        "Ref": "MyOS"
                    },
                    "MyOSHANA": {
                        "Ref": "MyOSHANA"
                    },
                    "ApplicationCIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet2AID"
                        ]
                    },
                    "PrivateSubnetID": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet1AID"
                        ]
                    },
                    "PrivateSubnet1AID": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet1AID"
                        ]
                    },
                    "PublicSubnet1ID": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PublicSubnet1ID"
                        ]
                    },
                    "PrivateSubnet1CIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet1ACIDR"
                        ]
                    },
                    "PrivateSubnet2CIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet2ACIDR"
                        ]
                    },
                    "PublicSubnet1CIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PublicSubnet1CIDR"
                        ]
                    },
                    "PublicSubnet2CIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PublicSubnet2CIDR"
                        ]
                    },
                    "QSS3BucketName": {
                        "Ref": "QSS3BucketName"
                    },
                    "QSS3KeyPrefix": {
                        "Ref": "QSS3KeyPrefix"
                    },
                    "RDPInstanceType": {
                        "Ref": "RDPInstanceType"
                    },
                    "SAPASCSHostname": {
                        "Ref": "SAPASCSHostname"
                    },
                    "StbySAPASCS": {
                        "Ref": "StbySAPASCS"
                    },
                    "SAPInstallMediaBucket": {
                        "Ref": "SAPInstallMediaBucket"
                    },
                    "SAPInstallMediaKeyPrefix": {
                        "Ref": "SAPInstallMediaKeyPrefix"
                    },
                    "SAPInstanceNum": {
                        "Ref": "SAPInstanceNum"
                    },
                    "SAPNetWeaverPass": {
                        "Ref": "HANAMasterPass"
                    },
                    "SAPTZ": {
                        "Ref": "SAPTZ"
                    },
                    "SID": {
                        "Ref": "SID"
                    },
                    "SIDadmUID": {
                        "Ref": "SIDadmUID"
                    },
                    "SLESBYOSRegCode": {
                        "Ref": "SLESBYOSRegCode"
                    },
                    "VPCID": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.VPCID"
                        ]
                    }
                }
            }
        },
        "SAPPASStackSplitandEFS": {
            "DependsOn": "SAPASCSStackSplitandEFS",
            "Condition": "SplitandEFS",
            "Type": "AWS::CloudFormation::Stack",
            "Properties": {
                "TemplateURL": {
                    "Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}templates/sap-s4hana-pas.template"
                },
                "Parameters": {
                    "AutoRecoveryAAS": {
                        "Ref": "AutoRecoveryAAS"
                    },
                    "AutoRecoveryPAS": {
                        "Ref": "AutoRecoveryPAS"
                    },
                    "AASMyInstanceType": {
                        "Ref": "AASMyInstanceType"
                    },
                    "CloudTrailS3Bucket": {
                        "Ref": "CloudTrailS3Bucket"
                    },
                    "EFSFSName": {
                        "Fn::GetAtt": [
                            "SAPASCSStackSplitandEFS",
                            "Outputs.EFSFSName"
                        ]
                    },
                    "EFSSapmnt": {
                        "Fn::GetAtt": [
                            "SAPASCSStackSplitandEFS",
                            "Outputs.EFSSapmnt"
                        ]
                    },
                    "EnableLogging": {
                        "Ref": "EnableLogging"
                    },
                    "Encryption": {
                        "Ref": "Encryption"
                    },
                    "HANAHostCount": {
                        "Ref": "HANAHostCount"
                    },
                    "HANAInstallMedia": {
                        "Ref": "HANAInstallMedia"
                    },
                    "HANAInstanceType": {
                        "Ref": "HANAInstanceType"
                    },
                    "SAPNetWeaverPass": {
                        "Ref": "HANAMasterPass"
                    },
                    "HostedZoneID": {
                        "Fn::GetAtt": [
                            "SAPASCSStackSplitandEFS",
                            "Outputs.HostedZoneID"
                        ]
                    },
                    "HostedZoneName": {
                        "Fn::GetAtt": [
                            "SAPASCSStackSplitandEFS",
                            "Outputs.HostedZoneName"
                        ]
                    },
                    "InstallRDPInstance": {
                        "Ref": "InstallRDPAndBastionInstance"
                    },
                    "InstallSAPAAS": {
                        "Ref": "InstallSAPAAS"
                    },
                    "InstallSAP": {
                        "Ref": "InstallSAP"
                    },
                    "InstallSAPVersion": {
                        "Ref": "InstallSAPVersion"
                    },
                    "KeyName": {
                        "Ref": "KeyName"
                    },
                    "MyInstanceType": {
                        "Ref": "MyInstanceType"
                    },
                    "MyOS": {
                        "Ref": "MyOS"
                    },
                    "MyOSHANA": {
                        "Ref": "MyOSHANA"
                    },
                    "PrivateSubnetID": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet1AID"
                        ]
                    },
                    "PrivateSubnet1CIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet1ACIDR"
                        ]
                    },
                    "PrivateSubnet2CIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet2ACIDR"
                        ]
                    },
                    "PublicSubnet1CIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PublicSubnet1CIDR"
                        ]
                    },
                    "PublicSubnet2CIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PublicSubnet2CIDR"
                        ]
                    },
                    "PublicSubnet1ID": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PublicSubnet1ID"
                        ]
                    },
                    "QSS3BucketName": {
                        "Ref": "QSS3BucketName"
                    },
                    "QSS3KeyPrefix": {
                        "Ref": "QSS3KeyPrefix"
                    },
                    "RDPInstanceType": {
                        "Ref": "RDPInstanceType"
                    },
                    "SAPAASHostname": {
                        "Ref": "SAPAASHostname"
                    },
                    "SAPHANAHostname": {
                        "Ref": "SAPHANAHostname"
                    },
                    "SAPInstallMediaBucket": {
                        "Ref": "SAPInstallMediaBucket"
                    },
                    "SAPInstallMediaKeyPrefix": {
                        "Ref": "SAPInstallMediaKeyPrefix"
                    },
                    "SAPPASHostname": {
                        "Ref": "SAPPASHostname"
                    },
                    "SAPInstanceNum": {
                        "Ref": "SAPInstanceNum"
                    },
                    "SAPTZ": {
                        "Ref": "SAPTZ"
                    },
                    "SAPSchemaName": {
                        "Ref": "SAPSchemaName"
                    },
                    "SID": {
                        "Ref": "SID"
                    },
                    "SIDadmUID": {
                        "Ref": "SIDadmUID"
                    },
                    "SLESBYOSRegCode": {
                        "Ref": "SLESBYOSRegCode"
                    },
                    "VolumeTypeHanaData": {
                        "Ref": "VolumeTypeHanaData"
                    },
                    "VolumeTypeHanaLog": {
                        "Ref": "VolumeTypeHanaLog"
                    },
                    "VPCID": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.VPCID"
                        ]
                    }
                }
            }
        },
        "SAPPASStackSplitNoEFS": {
            "DependsOn": "SAPASCSStackSplitNoEFS",
            "Condition": "SplitandNoEFS",
            "Type": "AWS::CloudFormation::Stack",
            "Properties": {
                "TemplateURL": {
                    "Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}templates/sap-s4hana-pas.template"
                },
                "Parameters": {
                    "AutoRecoveryAAS": {
                        "Ref": "AutoRecoveryAAS"
                    },
                    "AutoRecoveryPAS": {
                        "Ref": "AutoRecoveryPAS"
                    },
                    "AASMyInstanceType": {
                        "Ref": "AASMyInstanceType"
                    },
                    "CloudTrailS3Bucket": {
                        "Ref": "CloudTrailS3Bucket"
                    },
                    "EFSSapmnt": {
                        "Fn::GetAtt": [
                            "SAPASCSStackSplitNoEFS",
                            "Outputs.EFSSapmnt"
                        ]
                    },
                    "EnableLogging": {
                        "Ref": "EnableLogging"
                    },
                    "Encryption": {
                        "Ref": "Encryption"
                    },
                    "HANAHostCount": {
                        "Ref": "HANAHostCount"
                    },
                    "HANAInstallMedia": {
                        "Ref": "HANAInstallMedia"
                    },
                    "HANAInstanceType": {
                        "Ref": "HANAInstanceType"
                    },
                    "SAPNetWeaverPass": {
                        "Ref": "HANAMasterPass"
                    },
                    "HostedZoneID": {
                        "Fn::GetAtt": [
                            "SAPASCSStackSplitNoEFS",
                            "Outputs.HostedZoneID"
                        ]
                    },
                    "HostedZoneName": {
                        "Fn::GetAtt": [
                            "SAPASCSStackSplitNoEFS",
                            "Outputs.HostedZoneName"
                        ]
                    },
                    "InstallRDPInstance": {
                        "Ref": "InstallRDPAndBastionInstance"
                    },
                    "InstallSAPAAS": {
                        "Ref": "InstallSAPAAS"
                    },
                    "InstallSAP": {
                        "Ref": "InstallSAP"
                    },
                    "InstallSAPVersion": {
                        "Ref": "InstallSAPVersion"
                    },
                    "KeyName": {
                        "Ref": "KeyName"
                    },
                    "MyInstanceType": {
                        "Ref": "MyInstanceType"
                    },
                    "MyOS": {
                        "Ref": "MyOS"
                    },
                    "MyOSHANA": {
                        "Ref": "MyOSHANA"
                    },
                    "PrivateSubnetID": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet1AID"
                        ]
                    },
                    "PrivateSubnet1CIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet1ACIDR"
                        ]
                    },
                    "PrivateSubnet2CIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet2ACIDR"
                        ]
                    },
                    "PublicSubnet1CIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PublicSubnet1CIDR"
                        ]
                    },
                    "PublicSubnet2CIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PublicSubnet2CIDR"
                        ]
                    },
                    "PublicSubnet1ID": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PublicSubnet1ID"
                        ]
                    },
                    "QSS3BucketName": {
                        "Ref": "QSS3BucketName"
                    },
                    "QSS3KeyPrefix": {
                        "Ref": "QSS3KeyPrefix"
                    },
                    "RDPInstanceType": {
                        "Ref": "RDPInstanceType"
                    },
                    "SAPAASHostname": {
                        "Ref": "SAPAASHostname"
                    },
                    "SAPASCSHostname": {
                        "Ref": "SAPASCSHostname"
                    },
                    "SAPHANAHostname": {
                        "Ref": "SAPHANAHostname"
                    },
                    "SAPInstallMediaBucket": {
                        "Ref": "SAPInstallMediaBucket"
                    },
                    "SAPInstallMediaKeyPrefix": {
                        "Ref": "SAPInstallMediaKeyPrefix"
                    },
                    "SAPPASHostname": {
                        "Ref": "SAPPASHostname"
                    },
                    "SAPInstanceNum": {
                        "Ref": "SAPInstanceNum"
                    },
                    "SAPTZ": {
                        "Ref": "SAPTZ"
                    },
                    "SAPSchemaName": {
                        "Ref": "SAPSchemaName"
                    },
                    "SID": {
                        "Ref": "SID"
                    },
                    "SIDadmUID": {
                        "Ref": "SIDadmUID"
                    },
                    "SLESBYOSRegCode": {
                        "Ref": "SLESBYOSRegCode"
                    },
                    "VolumeTypeHanaData": {
                        "Ref": "VolumeTypeHanaData"
                    },
                    "VolumeTypeHanaLog": {
                        "Ref": "VolumeTypeHanaLog"
                    },
                    "VPCID": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.VPCID"
                        ]
                    }
                }
            }
        },
        "SAPHANAPASStackNoSplitNoEFS": {
            "DependsOn": "VPCStack",
            "Condition": "NoSplitandNoEFS",
            "Type": "AWS::CloudFormation::Stack",
            "Properties": {
                "TemplateURL": {
                    "Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}templates/sap-s4hana-exg-vpc-HA.template"
                },
                "Parameters": {
                    "AutoRecoveryAAS": {
                        "Ref": "AutoRecoveryAAS"
                    },
                    "AutoRecoveryPAS": {
                        "Ref": "AutoRecoveryPAS"
                    },
                    "AASMyInstanceType": {
                        "Ref": "AASMyInstanceType"
                    },
                    "CloudTrailS3Bucket": {
                        "Ref": "CloudTrailS3Bucket"
                    },
                    "EnableLogging": {
                        "Ref": "EnableLogging"
                    },
                    "Encryption": {
                        "Ref": "Encryption"
                    },
                    "HANAHostCount": {
                        "Ref": "HANAHostCount"
                    },
                    "SAPHANAHostname": {
                        "Ref": "SAPHANAHostname"
                    },
                    "HANAHostnameSecondary": {
                        "Ref": "HANAHostnameSecondary"
                    },
                    "HANAInstallMedia": {
                        "Ref": "HANAInstallMedia"
                    },
                    "HANAInstanceType": {
                        "Ref": "HANAInstanceType"
                    },
                    "HANAMasterPass": {
                        "Ref": "HANAMasterPass"
                    },
                    "HostedZoneName": {
                        "Ref": "HostedZoneName"
                    },
                    "InstallRDPInstance": {
                        "Ref": "InstallRDPAndBastionInstance"
                    },
                    "InstallSAPAAS": {
                        "Ref": "InstallSAPAAS"
                    },
                    "InstallSAP": {
                        "Ref": "InstallSAP"
                    },
                    "InstallSAPVersion": {
                        "Ref": "InstallSAPVersion"
                    },
                    "KeyName": {
                        "Ref": "KeyName"
                    },
                    "MyInstanceType": {
                        "Ref": "MyInstanceType"
                    },
                    "MyOS": {
                        "Ref": "MyOS"
                    },
                    "MyOSHANA": {
                        "Ref": "MyOSHANA"
                    },
                    "ApplicationCIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet2AID"
                        ]
                    },
                    "PrivateSubnetID": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet1AID"
                        ]
                    },
                    "PrivateSubnet1CIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet1ACIDR"
                        ]
                    },
                    "PrivateSubnet2CIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet2ACIDR"
                        ]
                    },
                    "PrivateSubnet1AID": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet1AID"
                        ]
                    },
                    "PublicSubnet1CIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PublicSubnet1CIDR"
                        ]
                    },
                    "PublicSubnet2CIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PublicSubnet2CIDR"
                        ]
                    },
                    "PublicSubnet1ID": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PublicSubnet1ID"
                        ]
                    },
                    "QSS3BucketName": {
                        "Ref": "QSS3BucketName"
                    },
                    "QSS3KeyPrefix": {
                        "Ref": "QSS3KeyPrefix"
                    },
                    "RDPInstanceType": {
                        "Ref": "RDPInstanceType"
                    },
                    "SAPAASHostname": {
                        "Ref": "SAPAASHostname"
                    },
                    "SAPHANAHostname": {
                        "Ref": "SAPHANAHostname"
                    },
                    "SAPInstallMediaBucket": {
                        "Ref": "SAPInstallMediaBucket"
                    },
                    "SAPInstallMediaKeyPrefix": {
                        "Ref": "SAPInstallMediaKeyPrefix"
                    },
                    "SAPPASHostname": {
                        "Ref": "SAPPASHostname"
                    },
                    "SAPInstanceNum": {
                        "Ref": "SAPInstanceNum"
                    },
                    "SAPTZ": {
                        "Ref": "SAPTZ"
                    },
                    "SAPSchemaName": {
                        "Ref": "SAPSchemaName"
                    },
                    "SID": {
                        "Ref": "SID"
                    },
                    "SIDadmUID": {
                        "Ref": "SIDadmUID"
                    },
                    "SLESBYOSRegCode": {
                        "Ref": "SLESBYOSRegCode"
                    },
                    "VolumeTypeHanaData": {
                        "Ref": "VolumeTypeHanaData"
                    },
                    "VolumeTypeHanaLog": {
                        "Ref": "VolumeTypeHanaLog"
                    },
                    "VPCID": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.VPCID"
                        ]
                    }
                }
            }
        },
        "SAPHANAPASStackNoSplitEFS": {
            "DependsOn": "VPCStack",
            "Condition": "NoSplitandEFS",
            "Type": "AWS::CloudFormation::Stack",
            "Properties": {
                "TemplateURL": {
                    "Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}templates/sap-s4hana-exg-vpc-HA.template"
                },
                "Parameters": {
                    "AutoRecoveryAAS": {
                        "Ref": "AutoRecoveryAAS"
                    },
                    "AutoRecoveryPAS": {
                        "Ref": "AutoRecoveryPAS"
                    },
                    "AASMyInstanceType": {
                        "Ref": "AASMyInstanceType"
                    },
                    "CloudTrailS3Bucket": {
                        "Ref": "CloudTrailS3Bucket"
                    },
                    "EFSSapmnt": {
                            "Ref": "EFSSapmnt"
                    },
                    "EnableLogging": {
                        "Ref": "EnableLogging"
                    },
                    "Encryption": {
                        "Ref": "Encryption"
                    },
                    "HANAHostCount": {
                        "Ref": "HANAHostCount"
                    },
                    "SAPHANAHostname": {
                        "Ref": "SAPHANAHostname"
                    },
                    "HANAHostnameSecondary": {
                        "Ref": "HANAHostnameSecondary"
                    },
                    "HANAInstallMedia": {
                        "Ref": "HANAInstallMedia"
                    },
                    "HANAInstanceType": {
                        "Ref": "HANAInstanceType"
                    },
                    "HANAMasterPass": {
                        "Ref": "HANAMasterPass"
                    },
                    "HostedZoneName": {
                        "Ref": "HostedZoneName"
                    },
                    "InstallRDPInstance": {
                        "Ref": "InstallRDPAndBastionInstance"
                    },
                    "InstallSAPAAS": {
                        "Ref": "InstallSAPAAS"
                    },
                    "InstallSAP": {
                        "Ref": "InstallSAP"
                    },
                    "InstallSAPVersion": {
                        "Ref": "InstallSAPVersion"
                    },
                    "KeyName": {
                        "Ref": "KeyName"
                    },
                    "MyInstanceType": {
                        "Ref": "MyInstanceType"
                    },
                    "MyOS": {
                        "Ref": "MyOS"
                    },
                    "MyOSHANA": {
                        "Ref": "MyOSHANA"
                    },
                    "ApplicationCIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet2AID"
                        ]
                    },
                    "PrivateSubnetID": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet1AID"
                        ]
                    },
                    "PrivateSubnet1CIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet1ACIDR"
                        ]
                    },
                    "PrivateSubnet2CIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet2ACIDR"
                        ]
                    },
                    "PrivateSubnet1AID": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet1AID"
                        ]
                    },
                    "PublicSubnet1CIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PublicSubnet1CIDR"
                        ]
                    },
                    "PublicSubnet2CIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PublicSubnet2CIDR"
                        ]
                    },
                    "PublicSubnet1ID": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PublicSubnet1ID"
                        ]
                    },
                    "QSS3BucketName": {
                        "Ref": "QSS3BucketName"
                    },
                    "QSS3KeyPrefix": {
                        "Ref": "QSS3KeyPrefix"
                    },
                    "RDPInstanceType": {
                        "Ref": "RDPInstanceType"
                    },
                    "SAPAASHostname": {
                        "Ref": "SAPAASHostname"
                    },
                    "SAPHANAHostname": {
                        "Ref": "SAPHANAHostname"
                    },
                    "SAPInstallMediaBucket": {
                        "Ref": "SAPInstallMediaBucket"
                    },
                    "SAPInstallMediaKeyPrefix": {
                        "Ref": "SAPInstallMediaKeyPrefix"
                    },
                    "SAPPASHostname": {
                        "Ref": "SAPPASHostname"
                    },
                    "SAPInstanceNum": {
                        "Ref": "SAPInstanceNum"
                    },
                    "SAPTZ": {
                        "Ref": "SAPTZ"
                    },
                    "SAPSchemaName": {
                        "Ref": "SAPSchemaName"
                    },
                    "SID": {
                        "Ref": "SID"
                    },
                    "SIDadmUID": {
                        "Ref": "SIDadmUID"
                    },
                    "SLESBYOSRegCode": {
                        "Ref": "SLESBYOSRegCode"
                    },
                    "VolumeTypeHanaData": {
                        "Ref": "VolumeTypeHanaData"
                    },
                    "VolumeTypeHanaLog": {
                        "Ref": "VolumeTypeHanaLog"
                    },
                    "VPCID": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.VPCID"
                        ]
                    }
                }
            }
        },
        "SAPStandardBuild": {
            "DependsOn": "VPCStack",
            "Type": "AWS::CloudFormation::Stack",
            "Condition": "StandardBuild",
            "Properties": {
                "TemplateURL": {
                    "Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}templates/sap-s4hana-exg-vpc.template"
                },
                "Parameters": {
                    "AutoRecoveryAAS": {
                        "Ref": "AutoRecoveryAAS"
                    },
                    "AutoRecoveryPAS": {
                        "Ref": "AutoRecoveryPAS"
                    },
                    "AASMyInstanceType": {
                        "Ref": "AASMyInstanceType"
                    },
                    "CloudTrailS3Bucket": {
                        "Ref": "CloudTrailS3Bucket"
                    },
                    "EFSSapmnt": {
                        "Ref": "EFSSapmnt"
                    },
                    "EnableLogging": {
                        "Ref": "EnableLogging"
                    },
                    "Encryption": {
                        "Ref": "Encryption"
                    },
                    "HANAHostCount": {
                        "Ref": "HANAHostCount"
                    },
                    "SAPHANAHostname": {
                        "Ref": "SAPHANAHostname"
                    },
                    "HANAHostnameSecondary": {
                        "Ref": "HANAHostnameSecondary"
                    },
                    "HANAInstallMedia": {
                        "Ref": "HANAInstallMedia"
                    },
                    "HANAInstanceType": {
                        "Ref": "HANAInstanceType"
                    },
                    "HANAMasterPass": {
                        "Ref": "HANAMasterPass"
                    },
                    "HostedZoneName": {
                        "Ref": "HostedZoneName"
                    },
                    "InstallRDPInstance": {
                        "Ref": "InstallRDPAndBastionInstance"
                    },
                    "InstallSAPAAS": {
                        "Ref": "InstallSAPAAS"
                    },
                    "InstallSAP": {
                        "Ref": "InstallSAP"
                    },
                    "InstallSAPVersion": {
                        "Ref": "InstallSAPVersion"
                    },
                    "KeyName": {
                        "Ref": "KeyName"
                    },
                    "MyInstanceType": {
                        "Ref": "MyInstanceType"
                    },
                    "MyOS": {
                        "Ref": "MyOS"
                    },
                    "MyOSHANA": {
                        "Ref": "MyOSHANA"
                    },
                    "ApplicationCIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet2AID"
                        ]
                    },
                    "PrivateSubnetID": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet1AID"
                        ]
                    },
                    "PrivateSubnet1CIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet1ACIDR"
                        ]
                    },
                    "PrivateSubnet2CIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet2ACIDR"
                        ]
                    },
                    "PrivateSubnet1AID": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PrivateSubnet1AID"
                        ]
                    },
                    "PublicSubnet1CIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PublicSubnet1CIDR"
                        ]
                    },
                    "PublicSubnet2CIDR": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PublicSubnet2CIDR"
                        ]
                    },
                    "PublicSubnet1ID": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.PublicSubnet1ID"
                        ]
                    },
                    "QSS3BucketName": {
                        "Ref": "QSS3BucketName"
                    },
                    "QSS3KeyPrefix": {
                        "Ref": "QSS3KeyPrefix"
                    },
                    "RDPInstanceType": {
                        "Ref": "RDPInstanceType"
                    },
                    "SAPAASHostname": {
                        "Ref": "SAPAASHostname"
                    },
                    "SAPHANAHostname": {
                        "Ref": "SAPHANAHostname"
                    },
                    "SAPInstallMediaBucket": {
                        "Ref": "SAPInstallMediaBucket"
                    },
                    "SAPInstallMediaKeyPrefix": {
                        "Ref": "SAPInstallMediaKeyPrefix"
                    },
                    "SAPPASHostname": {
                        "Ref": "SAPPASHostname"
                    },
                    "SAPInstanceNum": {
                        "Ref": "SAPInstanceNum"
                    },
                    "SAPTZ": {
                        "Ref": "SAPTZ"
                    },
                    "SAPSchemaName": {
                        "Ref": "SAPSchemaName"
                    },
                    "SID": {
                        "Ref": "SID"
                    },
                    "SAPSID": {
                        "Ref": "SAPSID"
                    },
                    "SIDadmUID": {
                        "Ref": "SIDadmUID"
                    },
                    "StandardInstall": {
                        "Ref": "StandardInstall"
                    },
                    "SLESBYOSRegCode": {
                        "Ref": "SLESBYOSRegCode"
                    },
                    "VolumeTypeHanaData": {
                        "Ref": "VolumeTypeHanaData"
                    },
                    "VolumeTypeHanaLog": {
                        "Ref": "VolumeTypeHanaLog"
                    },
                    "VPCID": {
                        "Fn::GetAtt": [
                            "VPCStack",
                            "Outputs.VPCID"
                        ]
                    }
                }
            }
        }
    },
  "Rules": {
    "EFSSupport": {
        "RuleCondition" : {
            "Fn::Equals": [{
                    "Ref": "EFSSapmnt"
                },
                "Yes"
            ]
        },
        "Assertions": [{
            "Assert": {
                "Fn::Contains": [
                    [
                        "us-east-1",
                        "us-east-2",
                        "us-west-1",
                        "us-west-2",
                        "eu-central-1",
                        "eu-west-1",
                        "eu-west-2",
                        "eu-west-3", 
                        "eu-central-1",
                        "ca-central-1",
                        "ap-south-1",
                        "ap-northeast-1",
                        "ap-northeast-2",
                        "ap-southeast-1",
                        "ap-southeast-2"
                    ],
                    {
                        "Ref": "AWS::Region"
                    }
                ]
            },
            "AssertDescription": "!!ALERT: This is *not* an AWS Region that supports EFS!!"
        }]
    }
  }
}